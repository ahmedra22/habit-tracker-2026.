<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ğŸ”¥</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f4f4f4;
            direction: rtl;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        th {
            background-color: #2c3e50;
            color: white;
        }

        img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .refresh-btn {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 10px;
            background: #27ae60;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ•µï¸â€â™‚ï¸</h1>
        <button class="refresh-btn" onclick="location.reload()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ”„</button>

        <table id="usersTable">
            <thead>
                <tr>
                    <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                    <th>Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td colspan="5">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¨Ø§Ù„Ø¸Ø¨Ø·
        const firebaseConfig = {
            apiKey: "AIzaSyA3Z9TUhNCqNR0PNosXLVT_TkTaZxIy-h8",
            authDomain: "habit-tracker-2026-c5d50.firebaseapp.com",
            projectId: "habit-tracker-2026-c5d50",
            storageBucket: "habit-tracker-2026-c5d50.firebasestorage.app",
            messagingSenderId: "424349537327",
            appId: "1:424349537327:web:ee63fdb204fb97b43022da"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© (Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ Ø¹Ø´Ø§Ù† Ù…Ø´ Ø£ÙŠ Ø­Ø¯ ÙŠØ¯Ø®Ù„)
        const password = prompt("Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø©:");

        if (password === "ahmed123") { // ØºÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ Ø¨Ø±Ø§Ø­ØªÙƒ
            fetchUsers();
        } else {
            document.body.innerHTML = "<h1 style='text-align:center; color:red; margin-top:50px;'>ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶! ğŸš«</h1>";
        }

        async function fetchUsers() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = ""; // ÙØ¶ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„

            try {
                // Ù‡Ø§Øª ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
                const querySnapshot = await getDocs(collection(db, "users"));

                querySnapshot.forEach((doc) => {
                    const data = doc.data();

                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ØµÙŠØºØ© Ù…Ù‚Ø±ÙˆØ¡Ø©
                    let lastSeen = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                    if (data.lastLogin) {
                        lastSeen = new Date(data.lastLogin.seconds * 1000).toLocaleDateString('ar-EG');
                    }

                    // Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
                    const habitsCount = data.habitNames ? data.habitNames.length : 7; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 7

                    const row = `
                        <tr>
                            <td><img src="${data.photoURL || 'https://via.placeholder.com/40'}" alt="pic"></td>
                            <td>${data.displayName || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                            <td>${data.email || '---'}</td>
                            <td>${lastSeen}</td>
                            <td>${habitsCount} Ø¹Ø§Ø¯Ø©</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error("Error:", error);
                tbody.innerHTML = `<tr><td colspan="5" style="color:red">Ø­ØµÙ„ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ Rules)</td></tr>`;
            }
        }
    </script>
</body>

</html>